<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>Online sorting</title>
    <link type="text/css" rel="stylesheet" href="style.css">
    <link rel="stylesheet" title="Default" href="highlight/styles/default.css">
    <script type="text/javascript" src="js/jquery-1.5.min.js"></script>
    <script type="text/javascript" src="highlight/highlight.pack.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
    </script>
</head>
<body>
<div class="page-wrap">
	<header class="page-header">
		<div class="logo"><a href="index.html">CSScomb</a></div>
		<nav>
			<ul>
				<li><b>Online sorting</b></li>
				<li><a href="about.html">About</a></li>
				<li><a href="tests.html">Tests</a></li>
				<li><a href="">Downloads</a></li>
			</ul>
		</nav>
	</header>
	<hgroup>
		<h1>Online sorting</h1>
		<p><span class="pseudo-link">URL</span> or <span class="pseudo-link">File</span></p>
		<div class="clear"></div>
	</hgroup>

	<div class="page">
		<div id="mode-selector" class="code-view-mode">
			<a id="mode-edit" class="pseudo-link" href="">Edit</a>
			<a id="mode-diff" class="pseudo-link" href="">Diff</a>
		</div>
		<div class="settings-link"><a href="">Settings</a></div>
		<div class="code">
			<table>
				<tr>
					<td class="code-line-numbers"></td>
					<td class="code-original">
						<pre id="code-original" class="css"></pre>
					</td>
					<td class="code-line-numbers"></td>
					<td class="code-resorted">
						<pre id="code-resorted" class="css"></pre>
					</td>
				</tr>
			</table>
		</div>
		<div class="code-actions">
			<button id="resort-button" class="button">Resort</button>
			<a id="copy-result-button" class="pseudo-link" href="">Copy result code</a>
		</div>
		<div class="clear"></div>
	</div>

	<footer class="page-footer">
		<p>
			<span>© 2009–2011, CSScomb v. 2.0</span>
			<a id="bug-report" href="">Bug report</a>
			<a href="">Follow me</a>
			<a href="">По-русски</a>
		</p>
	</footer>


	<script>
		var app = {

			codeOriginal:   "body,\n" +
							"html {\n" +
							"  font: Tahoma, Arial, san-serif;\n" +
							"  background: url('hatch.png');\n" +
							"}\n" +
							"\n" +
							"@import url('print.css');\n" +
							"\n" +
							"@media screen and (-webkit-min-device-pixel-ratio: 0) {\n" +
							"  @page :left {\n" +
							"    body:first-of-type pre::after {\n" +
							"      content: 'highlight: ' attr(class);\n" +
							"    }\n" +
							"}\n" +
							"\n" +
							"#content {\n" +
							"  width: /* wide enough */ 100% /* 400px */;\n" +
							"  height: 100%\n" +
							"}\n" +
							"        \n" +
							"p[lang=ru] {\n" +
							"  color: #F0F0F0; background: white !important;\n" +
							"}",

			container: {
				codeOriginal: document.getElementById('code-original'),

				codeResorted: document.getElementById('code-resorted'),

				resortButton: document.getElementById('resort-button'),

				copyResultButton: document.getElementById('copy-result-button'),

				modeSelector: document.getElementById('mode-selector')

			},

			/* Функция считает сколько строк в тексте text */
			countLines: function(text){
				var matches = text.match(/\n/g);
				return matches.length + 1;
			}



		}




		// Функция рисует в нужном месте (target) номера строк
		function drawLineNumbers(length, target){
			var n = document.createElement("div"); // создает контейнер-сборщик, чтобы дергать DOM только один раз для его вставки
			for(var i = 1; i <= length; i++){
				var span = document.createElement("span");
				span.innerHTML = i + '.';
				n.appendChild(span);
			}
			target.appendChild(n);
		}

		function drawDiff(){
			var ln = document.getElementsByClassName('code-line-numbers');
			for(var i = 0; i < ln.length; i++){
				drawLineNumbers(app.countLines(app.codeOriginal), ln[i]);
			}

			var code = document.createElement("code");
			code.innerHTML = app.codeOriginal;
			app.container.codeOriginal.appendChild(code);

			var code = document.createElement("code");
			code.innerHTML = app.codeOriginal;
			app.container.codeResorted.appendChild(code);

			app.container.resortButton.setAttribute('disabled','disabled');
			app.container.copyResultButton.removeAttribute('disabled')
		}

		function drawEdit(){
			var textarea = document.createElement("textarea");
			textarea.id = 'textarea';
			textarea.innerHTML = app.codeOriginal;
			textarea.style.height = app.container.codeOriginal.parentNode.offsetHeight - 4 + 'px'; // WTF?
			app.container.codeOriginal.parentNode.appendChild(textarea);

			app.container.copyResultButton.setAttribute('disabled','disabled');
			app.container.resortButton.removeAttribute('disabled')
		}
	//	drawEdit();

		function clear(){
			app.container.codeOriginal.innerHTML = app.container.codeResorted.innerHTML = '';

			if(document.getElementById('textarea')){
				document.getElementById('textarea').parent.removeChild('textarea');
			}

			var ln = document.getElementsByClassName('code-line-numbers');
			for(var i = 0; i < ln.length; i++){
				ln[i].innerHTML = '';
			}
		}
	//	clear();

		// режим редактирования
		$('#mode-edit').click(function(){
			var e = $('#mode-edit');
			if(!e.hasClass('selected')){
				e.addClass('selected');
				$('#mode-diff').removeClass();
				clear();
				drawEdit();
			}
			return false;
		});

		// режим сравнения
		$('#mode-diff').click(function(){
			var e = $('#mode-diff');
			if(!e.hasClass('selected')){
				e.addClass('selected');
				$('#mode-edit').removeClass();
				clear();
				drawDiff();
			}
			return false;
		});


		// кнопка копирования отсортированного кода
		$('#copy-result-button').click(function(){
			var e = $('#copy-result-button');
			if(e.attr('disabled') == 'disabled'){
				alert('1');
			}
			else {
				alert(0);
			}
			return false;
		});

		drawDiff();
		$('#mode-diff').addClass('selected');
	</script>
</div>
</body>
</html>